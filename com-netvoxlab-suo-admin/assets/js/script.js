var SuoAdminModule = {};

SuoAdminModule.host = "http://sq.mfc.ru/";
SuoAdminModule.orgs = [
    {
      "recId": "fb4724b9-eb95-4229-b101-195966902ee1",
      "id": "fb4724b9-eb95-4229-b101-195966902ee1",
      "name": "Многофункциональный центр предоставления государственных и муниципальных услуг город Владимир МФЦ Владимира",
      "attributes": {},
      "shortName": "МФЦ г. Владимир (Октябрьский пр-т)",
      "groupName": "Владимир",
      "address": "г. Владимир, Октябрьский пр-т, д.47",
      "isEnabled": true,
      "contactInfo": "Телефон: (4922)53-66-47, сайт http://www.mfcvladimir.ru",
      "engineId": "7975131d-dc70-467e-a0b9-673b893e5432",
      "endPoint": "",
      "city": {
        "recId": "d26360df-8f4c-4c75-8a8b-b890d9744cd5",
        "name": "Владимир",
        "childs": null
      },
      "placeTypeId": "866dc938-1d0e-44f3-8709-dd5cd0bd6901",
      "placeEmail": "vladokt@mfc.ru",
      "placeSubEmail": "vladokt@mfc.ru",
      "headPerson": "",
      "site": "http://www.mfcvladimir.ru",
      "phones": "(4922)53-66-47",
      "fiasId": null,
      "regionId": "59edbd09-d885-4584-a2f2-2d0dfb53839f"
    },
    {
      "recId": "b8c71f08-e713-4529-b9d2-e3769e200370",
      "id": "b8c71f08-e713-4529-b9d2-e3769e200370",
      "name": "Государственное бюджетное учреждение Владимирской области «Многофункциональный центр предоставления государственных и муниципальных услуг Владимирской области»",
      "attributes": {},
      "shortName": "МФЦ Гусь-Хрустальный",
      "groupName": "Владимирская область",
      "address": "601501, Владимирская область, г. Гусь-Хрустальный, ул. Владимирская, д. 1",
      "isEnabled": true,
      "contactInfo": "Телефон: 8(49241)2-05-96, Email:gus.mfc@yandex.ru, сайт: http://www.umfc.avo.ru/index.htm",
      "engineId": "7975131d-dc70-467e-a0b9-673b893e5432",
      "endPoint": "",
      "city": {
        "recId": "d26360df-8f4c-4c75-8a8b-b890d9744cd5",
        "name": "Владимир",
        "childs": null
      },
      "placeTypeId": "866dc938-1d0e-44f3-8709-dd5cd0bd6901",
      "placeEmail": "gus.mfc@yandex.ru",
      "placeSubEmail": "gus@mfc.ru",
      "headPerson": "",
      "site": "http://www.umfc.avo.ru/index.htm",
      "phones": "8(49241)2-05-96",
      "fiasId": null,
      "regionId": "59edbd09-d885-4584-a2f2-2d0dfb53839f"
    },
    {
      "recId": "d1c9ed97-995c-41f8-95fc-0db84171c20c",
      "id": "d1c9ed97-995c-41f8-95fc-0db84171c20c",
      "name": "МАУ МФЦ Алексеевского района\r\n",
      "attributes": {},
      "shortName": "МАУ МФЦ Алексеевского района\r\n",
      "groupName": "г. Алексеевка, ул. Победы, д. 67",
      "address": "г. Алексеевка, ул. Победы, д. 67\r\n",
      "isEnabled": true,
      "contactInfo": "",
      "engineId": "7975131d-dc70-467e-a0b9-673b893e5432",
      "endPoint": "",
      "city": {
        "recId": "384a7b3a-17ad-4c1b-a4d0-cad2b1c6518c",
        "name": "Белгород",
        "childs": null
      },
      "placeTypeId": "866dc938-1d0e-44f3-8709-dd5cd0bd6901",
      "placeEmail": "",
      "placeSubEmail": "",
      "headPerson": "",
      "site": "",
      "phones": "",
      "fiasId": null,
      "regionId": "55e8da0b-afbf-4110-a1a8-bf06e7dde2d4"
    },
    {
      "recId": "115d4c50-fecd-4a7b-8159-1ba2d359f267",
      "id": "115d4c50-fecd-4a7b-8159-1ba2d359f267",
      "name": "ГАУ БО МФЦ\r\n",
      "attributes": {},
      "shortName": "ГАУ БО МФЦ\r\n",
      "groupName": "г. Белгород",
      "address": "г. Белгрод, пр-т Славы, д. 25\r\n",
      "isEnabled": true,
      "contactInfo": "",
      "engineId": "7975131d-dc70-467e-a0b9-673b893e5432",
      "endPoint": "",
      "city": {
        "recId": "384a7b3a-17ad-4c1b-a4d0-cad2b1c6518c",
        "name": "Белгород",
        "childs": null
      },
      "placeTypeId": "866dc938-1d0e-44f3-8709-dd5cd0bd6901",
      "placeEmail": "",
      "placeSubEmail": "",
      "headPerson": "",
      "site": "",
      "phones": "",
      "fiasId": null,
      "regionId": "55e8da0b-afbf-4110-a1a8-bf06e7dde2d4"
    },
    {
      "recId": "92e62c6d-e1d9-4133-90c0-4ca0b50afec9",
      "id": "92e62c6d-e1d9-4133-90c0-4ca0b50afec9",
      "name": "МАУ МФЦ Белгородского района»\r\n",
      "attributes": {},
      "shortName": "МАУ МФЦ Белгородского района»\r\n",
      "groupName": "пгт. Разумное, ул. Скворцова, д. 6",
      "address": "пгт. Разумное, ул. Скворцова, д. 6\r\n",
      "isEnabled": true,
      "contactInfo": "",
      "engineId": "7975131d-dc70-467e-a0b9-673b893e5432",
      "endPoint": "",
      "city": {
        "recId": "384a7b3a-17ad-4c1b-a4d0-cad2b1c6518c",
        "name": "Белгород",
        "childs": null
      },
      "placeTypeId": "866dc938-1d0e-44f3-8709-dd5cd0bd6901",
      "placeEmail": "",
      "placeSubEmail": "",
      "headPerson": "",
      "site": "",
      "phones": "",
      "fiasId": null,
      "regionId": "55e8da0b-afbf-4110-a1a8-bf06e7dde2d4"
    }
  ];

SuoAdminModule.currentPlace = {};
SuoAdminModule.userToken = "";

SuoAdminModule.showPlaces = function() {
	console.log("showPlaces");
  $(".suo-admin").html('<label>Список организаций:</label><table id="SuoAdminList"></table><input type="button" id="SuoAddOrg" value="Добавить организацию"/><input type="button" id="SuoTemplates" value="Расписание"/>');
	
	$("#SuoAddOrg").click(SuoAdminModule.showCreateForm);
  $("#SuoTemplates").click(SuoAdminModule.templates);

	var htmlContent = "";
	$.each(SuoAdminModule.orgs, function(index, org) {
		console.log(index + ": " + org.shortName);
		htmlContent += "<tr><td>"+ org.name +"</td><td><input type='hidden' value='"+org.recId+"'><a class='change-link'>Изменить</a></td><td><a class='delete-link'>Удалить</a></td></tr>";
	});

	$("#SuoAdminList").html(htmlContent);

  $(".change-link").click(function(){
    var id = $(this).parent().children('input').val();
    SuoAdminModule.updatePlace(id);
  });

  $(".delete-link").click(function(){
    var id = $(this).parent().children('input').val();
    alert("Delete link click!");
  });
  //SuoAdminModule.getPlaces();
};

SuoAdminModule.showCreateForm = function() {
	console.log("showCreateForm");
	$(".suo-admin").html('<label>Полное название организации*:</label><input type="text" id="suoAdminOrgName" placeholder="Введите название организации" required /><label>Короткое название организации*: (Будет отображаться пользователю)</label><input type="text" id="suoAdminShortOrgName" placeholder="Введите короткое название организации" required /><label>Адрес организации*:</label><input id="SuoPlaceAddress" name="address" type="text" placeholder="Введите адрес организации" required /><!--[if lt IE 10]><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.1/jquery.xdomainrequest.min.js"></script><![endif]--><label>Email*: (Для уведомлений о записи на прием)</label><input type="text" id="SuoAdminEmail" placeholder="example@mail.com" required /><label>Номер телефона*:</label><input type="text" id="SuoAdminPhone" placeholder="+7-987-654-32-10" required /><label><input type="checkbox" id="SuoAdminIsEnable" value="value">Черновик (Не будет опубликовано сразу после создания)</label><input type="button" id="SuocreatePlace" value="Сохранить" /><input type="button" id="SuoCancel" value="Отмена"/>');

	$("#SuocreatePlace").click(SuoAdminModule.createPlace);
	$("#SuoCancel").click(SuoAdminModule.showPlaces);

	$("#SuoPlaceAddress").suggestions({
		token: "8dc53e3e7433a62222e2cabb494aedec79bc3e90",
		type: "ADDRESS",
		count: 5,
		onSelect: function(suggestion) {
			console.log('fias_id: ' + suggestion.data.fias_id);
		}
	});
};

SuoAdminModule.getPlaces = function() {
  $.ajax({
    headers: { "user_token" : SuoAdminModule.userToken, "app_id" : "9b1bae07-3852-412f-b26f-c4b8b3bad5f1" },
    url: SuoAdminModule.host + "v1/admin/place/getplaces",
    dataType: 'json',
  })
  .done(function (data, status, jqxhr) {
    console.log("getPlaces done!");
    console.log(data);

    SuoAdminModule.orgs = data.placeList;

    var htmlContent = "";
    $.each(data.placeList, function(index, place) {
      console.log(index + ": " + place.shortName);
      htmlContent += "<tr><td>"+ place.name +"</td><td><input type='hidden' value='"+place.recId+"'><a class='change-link'>Изменить</a></td><td><a class='delete-link'>Удалить</a></td></tr>";
    });

    $("#SuoAdminList").html(htmlContent);

    $(".change-link").click(function(){
    var id = $(this).parent().children('input').val();
      SuoAdminModule.updatePlace(id);
    });

    $(".delete-link").click(function(){
      var id = $(this).parent().children('input').val();
      alert("Delete link click!");
    });
  })
  .fail(function() {
    alert("Ошибка получения списка организаций!");
  });
};

SuoAdminModule.createPlace = function() {
	$.ajax({
		headers: { "user_token" : SuoAdminModule.userToken, "app_id" : "9b1bae07-3852-412f-b26f-c4b8b3bad5f1" },
		type: "POST",
		contentType: "application/json",
		url: SuoAdminModule.host + "v1/admin/place/addorupdate",
		data: JSON.stringify({
			"recId": "null",
			"id": null,
			"name": $("#suoAdminOrgName").val(),
			"shortName": $("#suoAdminShortOrgName").val(),
			"attributes": null,
			"groupName": "",
			"address": $("#SuoPlaceAddress").val(),
			"isEnabled": false,
			"contactInfo": "",
			"engineId": null,
			"endPoint": null,
			"city": {
				"recId": "",
				"name": "",
				"childs": null
			},
      "placeTypeId": "866dc938-1d0e-44f3-8709-dd5cd0bd6901",
      "placeEmail": $("#SuoAdminEmail").val(),
      "placeSubEmail": "",
      "headPerson": "",
      "site": "",
      "phones": $("#SuoAdminPhone").val(),
      "fiasId": null,
      "regionId": "59edbd09-d885-4584-a2f2-2d0dfb53839f"
		}),
		dataType: 'json',
	})
	.done(function (data, status, jqxhr) {
		console.log("createPlace done!");
		console.log(data);

		if(data.result == true) {
			alert("Организация успешно создана!");
		} else {
			alert("Ошибка создания организации! Message: " + data.message);
		};
	})
	.fail(function() {
		alert("Ошибка создания организации!");
	});

  /*
	SuoAdminModule.orgs.push(
	 {
      "recId": "null",
      "id": null,
      "name": $("#suoAdminOrgName").val(),
      "attributes": {},
      "shortName": $("#suoAdminShortOrgName").val(),
      "groupName": "Владимир",
      "address": $("#SuoPlaceAddress").val(),
      "isEnabled": false,
      "contactInfo": "",
      "engineId": "7975131d-dc70-467e-a0b9-673b893e5432",
      "endPoint": "",
      "city": {
        "recId": "d26360df-8f4c-4c75-8a8b-b890d9744cd5",
        "name": "Владимир",
        "childs": null
      },
      "placeTypeId": "866dc938-1d0e-44f3-8709-dd5cd0bd6901",
      "placeEmail": $("#SuoAdminEmail").val(),
      "placeSubEmail": "vladokt@mfc.ru",
      "headPerson": "",
      "site": "http://www.mfcvladimir.ru",
      "phones": $("#SuoAdminPhone").val(),
      "fiasId": null,
      "regionId": "59edbd09-d885-4584-a2f2-2d0dfb53839f"
    });*/

  SuoAdminModule.getPlaces();
};

SuoAdminModule.updatePlace = function(recId) {
  console.log("updatePlace");

  var place = SuoAdminModule.orgs.find(function(element, index, array){
    return (element.recId == recId);
  });

  $(".suo-admin").html('<label>Полное название организации*:</label><input type="text" id="suoAdminOrgName" placeholder="Введите название организации" required /><label>Короткое название организации*: (Будет отображаться пользователю)</label><input type="text" id="suoAdminShortOrgName" placeholder="Введите короткое название организации" required /><label>Адрес организации*:</label><input id="SuoPlaceAddress" name="address" type="text" placeholder="Введите адрес организации" required /><!--[if lt IE 10]><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.1/jquery.xdomainrequest.min.js"></script><![endif]--><label>Email*: (Для уведомлений о записи на прием)</label><input type="text" id="SuoAdminEmail" placeholder="example@mail.com" required /><label>Номер телефона*:</label><input type="text" id="SuoAdminPhone" placeholder="+7-987-654-32-10" required /><label><input type="checkbox" id="SuoAdminIsEnable" value="value">Черновик (Не будет опубликовано сразу после создания)</label><input type="button" id="SuocreatePlace" value="Сохранить" /><input type="button" id="SuoCancel" value="Отмена"/>');

  $("#SuocreatePlace").click(SuoAdminModule.createPlace);
  $("#SuoCancel").click(SuoAdminModule.showPlaces);

  $("#suoAdminOrgName").val(place.name);
  $("#suoAdminShortOrgName").val(place.shortName);
  $("#SuoPlaceAddress").val(place.address);
  $("#SuoAdminEmail").val(place.placeEmail);
  $("#SuoAdminPhone").val(place.phones);

  $("#SuoPlaceAddress").suggestions({
    token: "8dc53e3e7433a62222e2cabb494aedec79bc3e90",
    type: "ADDRESS",
    count: 5,
    onSelect: function(suggestion) {
      console.log('fias_id: ' + suggestion.data.fias_id);
    }
  });
};

SuoAdminModule.templates = function() {
  var html = '<h3>Шаблоны расписания организации</h3><table><tr><td><span>Название шаблона</span></td><td><span>По умолчанию</span></td></tr><tr><td><span>Обычное расписание организации</span></td><td><input type="radio" name="rd"></td></tr><tr><td><span>Расписание для Госуслуг слабослышащих граждан</span></td><td><input type="radio" name="rd"></td></tr><tr><td><span>Расписание для услуг Росжелдора</span></td><td><input type="radio" name="rd"></td></tr></table><input type="button" id="SuoAddTemplate" name="add" value="Добавить" /><a href="#">Настройки расписания</a>';

  $(".suo-admin").html(html);

  $("#SuoAddTemplate").click(SuoAdminModule.createTemplate);
};

SuoAdminModule.createTemplate = function() {

  var html = '<h1>Изменение шаблона расписания организации</h1><p>Продолжительность приема одного посетителя (в мин.) <input type="text" name="time" /></p><p>ПН <select><option selected="true">Рабочий день (с 9 до 18 с перерывом на обед)</option><option>Сокращенный рабочий день (с 9 до 12 без обеда)</option><option>Выходной день</option></select></p><p>ВТ <select><option selected="true">Рабочий день (с 9 до 18 с перерывом на обед)</option><option>Сокращенный рабочий день (с 9 до 12 без обеда)</option><option>Выходной день</option></select></p><p>СР <select><option selected="true">Рабочий день (с 9 до 18 с перерывом на обед)</option><option>Сокращенный рабочий день (с 9 до 12 без обеда)</option><option>Выходной день</option></select></p><p>ЧТ <select><option selected="true">Рабочий день (с 9 до 18 с перерывом на обед)</option><option>Сокращенный рабочий день (с 9 до 12 без обеда)</option><option>Выходной день</option></select></p><p>ПТ <select><option>Рабочий день (с 9 до 18 с перерывом на обед)</option><option selected="true">Сокращенный рабочий день (с 9 до 12 без обеда)</option><option>Выходной день</option></select></p><p>СБ <select><option>Рабочий день (с 9 до 18 с перерывом на обед)</option><option>Сокращенный рабочий день (с 9 до 12 без обеда)</option><option selected="true">Выходной день</option></select></p><p>ВС <select><option>Рабочий день (с 9 до 18 с перерывом на обед)</option><option>Сокращенный рабочий день (с 9 до 12 без обеда)</option><option selected="true">Выходной день</option></select></p><p><input type="checkbox" name="">Применять этот шаблон для создания расписания по-умолчанию</p><input type="button" name="save" value="Сохранить" /><input type="button" name="save" value="Отмена" />';

  $(".suo-admin").html(html);
};

$(document).ready(function() {

  SuoAdminModule.showPlaces();

  SuoAdminModule.userToken = suo_user_token_response.recId;
  //if(SuoAdminModule.userToken) {
  //  console.log("userToken:" + SuoAdminModule.userToken);
    //SuoAdminModule.getPlaces();
  //} else {
  //  $(".suo-admin").html("<p>Ошибка авторизации</p>");
  //}
});
